var map=L.map("map");function showPosition(t){map.setView([t.coords.latitude,t.coords.longitude],6)}navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):document.getElementById("demo").innerText="Geolocation is not supported by this browser.",$(window).on("load",(function(){$("#preloader").length&&$("#preloader").delay(1e3).fadeOut("slow",(function(){$(this).remove()}))}));var Thunderforest_Neighbourhood=L.tileLayer("https://{s}.tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey=e24c409ff68c47bb974a643883a6842b",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:"e24c409ff68c47bb974a643883a6842b",maxZoom:22});L.tileLayer.provider("Thunderforest.Landscape",{apikey:"e24c409ff68c47bb974a643883a6842b"}).addTo(map);const languageNames=new Intl.DisplayNames(["en"],{type:"language"});var currentCountry,currentCountryCode,currentCurrency,currentCapital,lon,lat;function getCountryName(t,e){$.ajax({url:"libs/php/getCountry.php",type:"GET",dataType:"json",data:{lat:t,lng:e},success:function(t){JSON.stringify(t),"ok"==t.status.name&&("countryName"in t.data?(currentCountry=t.data.countryName,currentCountryCode=t.data.countryCode,document.getElementById("countryOptions").value=currentCountry,popUp()):document.getElementById("newPopUp").style.display="none")},error:function(t,e,n){console.log("Find the country isn't working"),console.log(e),console.log(n)}})}var newPopUp=new bootstrap.Modal(document.getElementById("newPopUp"));function popUp(){newPopUp.show(),$("#countryName").html(currentCountry),$("#countryName2").html(currentCountry),$("#countryName3").html(currentCountry),getCountryInfo(),getCountryBorders(),getCurrentNews(),document.getElementById("countryFlagImg").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("countryFlagImg2").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("countryFlagImg3").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("wikipediaLink").href=`https://en.wikipedia.org/wiki/${currentCountry}`,document.getElementById("wikipediaLink2").href=`https://en.wikipedia.org/wiki/${currentCountry}`,document.getElementById("wikipediaLink3").href=`https://en.wikipedia.org/wiki/${currentCountry}`}function getCountryInfo(){$.ajax({url:"libs/php/getCountryInfo.php",type:"POST",dataType:"json",data:{country:currentCountryCode},success:function(t){if(JSON.stringify(t),"ok"==t.status.name){currentCapital=t.data.geonames[0].capital;const e=t.data.geonames[0].population,n=t.data.geonames[0].languages,o=t.data.geonames[0].continentName,r=t.data.geonames[0].areaInSqKm;currentCurrency=t.data.geonames[0].currencyCode;const a=n.split(","),c=[];for(language of a){const t=languageNames.of(language);c.push(t)}getExchangeRate(),getCurrentWeather(),document.getElementById("capitalCity").innerText=currentCapital,document.getElementById("capitalCity2").innerText=currentCapital,document.getElementById("population").innerText=parseInt(e).toLocaleString("en-GB"),document.getElementById("languagesSpoken").innerText=c.join(", "),document.getElementById("continentName").innerText=o,document.getElementById("countrySurface").innerText=`${r} km²`,document.getElementById("currency").innerText=currentCurrency}},error:function(t,e,n){console.log("Get country info isn't working"),console.log(e),console.log(n)}})}function onMapClick(t){getCountryName(t.latlng.lat,t.latlng.lng)}function getCountryOptions(){$.ajax({url:"libs/php/getCountrySearchOptions.php",type:"POST",dataType:"json",data:{},success:function(t){const e=t.data,n=document.getElementById("countryOptions");e.sort(),e.forEach((function(t){const e=document.createElement("option");e.value=t,e.innerText=t,n.appendChild(e)}))},error:function(t,e,n){console.log("Get Country Options not working"),console.log(e),console.log(n)}})}function getCountryCode(){$.ajax({url:"libs/php/getCountryCode.php",type:"GET",dataType:"json",data:{currentCountry:currentCountry},success:function(t){JSON.stringify(t),"ok"==t.status.name&&(currentCountryCode=t.data,popUp())},error:function(t,e,n){console.log("Get country code isn't working"),console.log(e),console.log(n)}})}function getExchangeRate(){$.ajax({url:"libs/php/getExchangeRate.php",type:"GET",dataType:"json",data:{currentCurrency:currentCurrency},success:function(t){const e=`1 USD equals ${t.data} ${currentCurrency}.`;document.getElementById("exchangeRate").innerText=e},error:function(t,e,n){console.log("Get exchange rate isn't working"),console.log(e),console.log(n)}})}function getCurrentNews(){$.ajax({url:"libs/php/getCurrentNews.php",type:"GET",dataType:"json",data:{country:currentCountryCode},success:function(t){let e="";for(article in t.data.articles){const n=t.data.articles[article].urlToImage,o=t.data.articles[article].title,r=t.data.articles[article].description,a=t.data.articles[article].url;if(null!=n&&null!=o&&null!=r){e+=`\n                    <div>\n                    <section><a class ="text-decoration-none" href="${a}" target="_blank"><img src="${n}" alt=""></a></section>\n                    <section><h3>${o}</h3></section>\n                    <section><p>${r}</p></section>\n                    </div>\n                    `}}document.getElementById("newsArticle").innerHTML=e}})}function getCountryBorders(){$.ajax({url:"libs/php/getCountryBorders.php",type:"GET",dataType:"json",data:{currentCountryCode:currentCountryCode},success:function(t){if(JSON.stringify(t),"ok"==t.status.name){clearMap();const e=t.data,n=L.polygon(e,{color:"pink"}).addTo(map);map.fitBounds(n.getBounds())}},error:function(t,e,n){console.log("Get country borders isn't working"),console.log(e),console.log(n)}})}function getCurrentWeather(){$.ajax({url:"libs/php/getCurrentWeather.php",type:"GET",dataType:"json",data:{capital:currentCapital},success:function(t){if("ok"==t.status.name){let e=t.data.main.temp;lon=t.data.coord.lon,lat=t.data.coord.lat,document.getElementById("currentTemp").innerText=`${Math.round(e)}°C`;let n=t.data.weather[0].icon;document.getElementById("weatherIcon1").src=`http://openweathermap.org/img/wn/${n}@2x.png`,getWeatherForecast()}},error:function(t,e,n){console.log("Get current weather isn't working"),console.log(e),console.log(n)}})}function getWeatherForecast(){$.ajax({url:"libs/php/getWeatherForecast.php",type:"GET",dataType:"json",data:{lat:lat,lon:lon},success:function(t){if("ok"==t.status.name){let e=t.data.list[0].dt,n=t.data.list[0].main.temp,o=`${new Date(1e3*e).getHours()}:00`;document.getElementById("time1").innerText=o,document.getElementById("temp1").innerText=`${Math.round(n)}°C`;let r=t.data.list[1].dt,a=t.data.list[1].main.temp,c=`${new Date(1e3*r).getHours()}:00`;document.getElementById("time2").innerText=c,document.getElementById("temp2").innerText=`${Math.round(a)}°C`;let i=t.data.list[2].dt,u=t.data.list[2].main.temp,l=`${new Date(1e3*i).getHours()}:00`;document.getElementById("time3").innerText=l,document.getElementById("temp3").innerText=`${Math.round(u)}°C`;let s=t.data.list[0].weather[0].icon;document.getElementById("weatherIcon2").src=`http://openweathermap.org/img/wn/${s}@2x.png`;let d=t.data.list[1].weather[0].icon;document.getElementById("weatherIcon3").src=`http://openweathermap.org/img/wn/${d}@2x.png`;let p=t.data.list[2].weather[0].icon;document.getElementById("weatherIcon4").src=`http://openweathermap.org/img/wn/${p}@2x.png`}}})}function clearMap(){for(i in map._layers)if(null!=map._layers[i]._path)try{map.removeLayer(map._layers[i])}catch(t){console.log("problem with "+t+map._layers[i])}}$("#searchForm").submit((function(t){t.preventDefault()})),map.on("click",onMapClick),document.getElementById("countryOptions").options,$(document).ready((function(){getCountryOptions()})),$("#countryOptions").change((function(){currentCountry=document.getElementById("countryOptions").value,getCountryCode()})),$("select").on("click",(function(){$(this).parent(".select-box").toggleClass("open")})),$(document).mouseup((function(t){var e=$(".select-box");0===e.has(t.target).length&&e.removeClass("open")})),$("select").on("change",(function(){var t=$(this).find("option:selected").text(),e=$(this).attr("id");$("[for='"+e+"']").find(".label-desc").html(t)}));