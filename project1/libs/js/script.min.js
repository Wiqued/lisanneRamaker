var map=L.map("map",doubleClickZoom=!1);function showPosition(e){getPopUp(e.coords.latitude,e.coords.longitude)}map.setView([52.132,5.291],6),navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):document.getElementById("demo").innerText="Geolocation is not supported by this browser.",$(window).on("load",(function(){$("#preloader").length&&$("#preloader").delay(1e3).fadeOut("slow",(function(){$(this).remove()}))}));var Thunderforest_Neighbourhood=L.tileLayer("https://{s}.tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey=e24c409ff68c47bb974a643883a6842b",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:"e24c409ff68c47bb974a643883a6842b",maxZoom:22});L.tileLayer.provider("Thunderforest.Landscape",{apikey:"e24c409ff68c47bb974a643883a6842b"}).addTo(map);const languageNames=new Intl.DisplayNames(["en"],{type:"language"});let currentCountry,currentCountryCode,currentCurrency,currentCapital,lon,lat;$("#searchForm").submit((function(e){e.preventDefault()}));const webcamMarkers=L.markerClusterGroup({showCoverageOnHover:!1,iconCreateFunction:function(e){var t=e.getChildCount();return new L.DivIcon({html:"<div><span>"+t+"</span></div>",className:"marker-cluster webcamCluster",iconSize:new L.Point(40,40)})}}).addTo(map),airportMarkers=L.markerClusterGroup({showCoverageOnHover:!1,iconCreateFunction:function(e){var t=e.getChildCount();return new L.DivIcon({html:"<div><span>"+t+"</span></div>",className:"marker-cluster airportCluster",iconSize:new L.Point(40,40)})}}).addTo(map),capitalLayerGroup=L.layerGroup().addTo(map);function getCountryOptions(){$.ajax({url:"libs/php/getCountrySearchOptions.php",type:"POST",dataType:"json",data:{},success:function(e){const t=e.data,n=document.getElementById("countryOptions");t.sort(),t.forEach((function(e){const t=document.createElement("option");t.value=e,t.innerText=e,n.appendChild(t)}))},error:function(e,t,n){console.log("Get Country Options not working"),console.log(t),console.log(n)}})}function getPopUp(e,t){$.ajax({url:"libs/php/getCountry.php",type:"GET",dataType:"json",data:{lat:e,lng:t},success:function(e){JSON.stringify(e),"ok"==e.status.name&&("countryName"in e.data?(currentCountry=e.data.countryName,currentCountryCode=e.data.countryCode,$("#countryOptions").val(currentCountry).trigger("change"),$("#newPopUp.modal-backdrop").remove()):document.getElementById("newPopUp").style.display="none")},error:function(e,t,n){console.log("Find the country isn't working"),console.log(t),console.log(n)}})}document.getElementById("countryOptions").options,$(document).ready((function(){getCountryOptions()})),L.easyButton("fa-solid fa-circle-info",(function(){new bootstrap.Modal(document.getElementById("newPopUp")).show()})).addTo(map),L.easyButton("fa-regular fa-sun",(function(){new bootstrap.Modal(document.getElementById("openWeatherToggle")).show()})).addTo(map),L.easyButton("fa-regular fa-newspaper",(function(){new bootstrap.Modal(document.getElementById("openNewsToggle")).show()})).addTo(map);var newPopUp=new bootstrap.Modal(document.getElementById("newPopUp"));function popUp(){newPopUp.show(),$("#countryName").html(currentCountry),$("#countryName2").html(currentCountry),$("#countryName3").html(currentCountry),getCountryInfo(),getCountryBorders(),getCurrentNews(),getNeighbours(),getRestInfo(),document.getElementById("countryFlagImg").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("countryFlagImg2").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("countryFlagImg3").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("wikipediaLink").href=`https://en.wikipedia.org/wiki/${currentCountry}`,document.getElementById("wikipediaLink2").href=`https://en.wikipedia.org/wiki/${currentCountry}`,document.getElementById("wikipediaLink3").href=`https://en.wikipedia.org/wiki/${currentCountry}`}function getCountryInfo(){$.ajax({url:"libs/php/getCountryInfo.php",type:"POST",dataType:"json",data:{country:currentCountryCode},success:function(e){if(JSON.stringify(e),"ok"==e.status.name){currentCapital=e.data.geonames[0].capital;const t=e.data.geonames[0].population,n=e.data.geonames[0].languages,o=e.data.geonames[0].continentName;let a=e.data.geonames[0].areaInSqKm;currentCurrency=e.data.geonames[0].currencyCode;const r=n.split(","),c=[];for(language of r){const e=languageNames.of(language);c.push(e)}getExchangeRate(),getCurrentWeather(),getCapitalCoords(),getWebcam(),getAirports(),a=parseInt(a).toLocaleString("en-GB"),document.getElementById("capitalCity").innerText=currentCapital,document.getElementById("capitalCity2").innerText=currentCapital,document.getElementById("population").innerText=parseInt(t).toLocaleString("en-GB"),document.getElementById("languagesSpoken").innerText=c.join(", "),document.getElementById("continentName").innerText=o,document.getElementById("countrySurface").innerText=`${a} km²`,document.getElementById("currency").innerText=currentCurrency}},error:function(e,t,n){console.log("Get country info isn't working"),console.log(t),console.log(n)}})}function onMapClick(e){getPopUp(e.latlng.lat,e.latlng.lng)}function getCountryCode(){$.ajax({url:"libs/php/getCountryCode.php",type:"GET",dataType:"json",data:{currentCountry:currentCountry},success:function(e){JSON.stringify(e),"ok"==e.status.name&&(currentCountryCode=e.data,popUp())},error:function(e,t,n){console.log("Get country code isn't working"),console.log(t),console.log(n)}})}function getExchangeRate(){$.ajax({url:"libs/php/getExchangeRate.php",type:"GET",dataType:"json",data:{currentCurrency:currentCurrency},success:function(e){const t=`1 USD equals ${e.data} ${currentCurrency}.`;document.getElementById("exchangeRate").innerText=t},error:function(e,t,n){console.log("Get exchange rate isn't working"),console.log(t),console.log(n)}})}function getCurrentNews(){$.ajax({url:"libs/php/getCurrentNews.php",type:"GET",dataType:"json",data:{country:currentCountryCode},success:function(e){let t="";for(article in e.data.articles){const n=e.data.articles[article].urlToImage,o=e.data.articles[article].title,a=e.data.articles[article].description,r=e.data.articles[article].url;if(null!=n&&null!=o&&null!=a){t+=`\n                    <div>\n                    <section><a class="article" href="${r}" target="_blank"><img src="${n}" alt=""></a></section>\n                    <section><h3><a class="article" href="${r}" target="_blank">${o}</a></h3></section>\n                    <section><p><a class="article" href="${r}" target="_blank">${a}</a></p></section>\n                    </div>\n                    `}}document.getElementById("newsArticle").innerHTML=t}})}function getCountryBorders(){$.ajax({url:"libs/php/getCountryBorders.php",type:"GET",dataType:"json",data:{currentCountryCode:currentCountryCode},success:function(e){if(JSON.stringify(e),"ok"==e.status.name){clearMap();const t=e.data,n=L.geoJSON(t,{color:"#588157"}).addTo(map);map.fitBounds(n.getBounds())}},error:function(e,t,n){console.log("Get country borders isn't working"),console.log(t),console.log(n)}})}function getCurrentWeather(){$.ajax({url:"libs/php/getCurrentWeather.php",type:"GET",dataType:"json",data:{capital:currentCapital},success:function(e){if("ok"==e.status.name){let t=e.data.main.temp;lon=e.data.coord.lon,lat=e.data.coord.lat,document.getElementById("currentTemp").innerText=`${Math.round(t)}°C`;let n=e.data.weather[0].icon;document.getElementById("weatherIcon1").src=`https://openweathermap.org/img/wn/${n}@2x.png`,getWeatherForecast()}},error:function(e,t,n){console.log("Get current weather isn't working"),console.log(t),console.log(n)}})}function getWeatherForecast(){$.ajax({url:"libs/php/getWeatherForecast.php",type:"GET",dataType:"json",data:{lat:lat,lon:lon},success:function(e){if("ok"==e.status.name){let t=e.data.list[0].dt,n=e.data.list[0].main.temp,o=`${new Date(1e3*t).getHours()}:00`;document.getElementById("time1").innerText=o,document.getElementById("temp1").innerText=`${Math.round(n)}°C`;let a=e.data.list[1].dt,r=e.data.list[1].main.temp,c=`${new Date(1e3*a).getHours()}:00`;document.getElementById("time2").innerText=c,document.getElementById("temp2").innerText=`${Math.round(r)}°C`;let s=e.data.list[2].dt,i=e.data.list[2].main.temp,l=`${new Date(1e3*s).getHours()}:00`;document.getElementById("time3").innerText=l,document.getElementById("temp3").innerText=`${Math.round(i)}°C`;let u=e.data.list[0].weather[0].icon;document.getElementById("weatherIcon2").src=`https://openweathermap.org/img/wn/${u}@2x.png`;let d=e.data.list[1].weather[0].icon;document.getElementById("weatherIcon3").src=`https://openweathermap.org/img/wn/${d}@2x.png`;let p=e.data.list[2].weather[0].icon;document.getElementById("weatherIcon4").src=`https://openweathermap.org/img/wn/${p}@2x.png`}}})}function getNeighbours(){$.ajax({url:"libs/php/getNeighbours.php",type:"POST",dataType:"json",data:{country:currentCountryCode},success:function(e){if("ok"==e.status.name){let t=[];e.data.forEach((e=>{const n=e.countryName;t.push(n)})),document.getElementById("countryNeighbours").innerText=t.join(", ")}},error:function(e,t,n){console.log("Get neighbours isn't working"),console.log(t),console.log(n)}})}function getRestInfo(){$.ajax({url:"libs/php/getRestInfo.php",type:"POST",dataType:"json",data:{currentCountryCode:currentCountryCode},success:function(e){if("ok"==e.status.name){let t=Object.values(e.data[0].name.nativeName)[0].common,n=Object.values(e.data[0].currencies)[0].symbol,o=e.data[0].car.side;if(e.data[0].postalCode){let t=e.data[0].postalCode.format;document.getElementById("postalCode").innerText=t.split("|").join(", ")}else document.getElementById("postalCode").innerText="Info not available";let a=e.data[0].tld[0];document.getElementById("nativeName").innerText=t,document.getElementById("currencySymbol").innerText=n,document.getElementById("drivingSide").innerText=o,document.getElementById("domainFormat").innerText=a}},error:function(e,t,n){console.log("Get rest info isn't working"),console.log(t),console.log(n)}})}function getCapitalCoords(){$.ajax({url:"libs/php/getCapitalCoords.php",type:"POST",dataType:"json",data:{currentCapital:currentCapital},success:function(e){if("ok"==e.status.name){const n=e.data.results[0].geometry.lat,o=e.data.results[0].geometry.lng;var t=L.ExtraMarkers.icon({icon:"fa-thumbtack",markerColor:"#e76f51",shape:"circle",prefix:"fa",svg:!0});L.marker([n,o],{icon:t}).addTo(capitalLayerGroup).on("click",(function(t){let n=new bootstrap.Modal(document.getElementById("openCapitalToggle"));const o=e.data.results[0].annotations.callingcode,a=e.data.results[0].annotations.timezone.short_name,r=e.data.results[0].components.state;let c=e.data.results[0].annotations.sun.rise.civil,s=e.data.results[0].annotations.sun.set.civil,i=`${new Date(1e3*c).getHours()}:00`,l=`${new Date(1e3*s).getHours()}:00`;const u=e.data.results[0].annotations.what3words.words;n.show(),document.getElementById("cityCapital").innerText=currentCapital,document.getElementById("callingCode").innerText=`+${o}`,document.getElementById("timezone").innerText=a,document.getElementById("capitalState").innerText=r,document.getElementById("sunrise").innerText=i,document.getElementById("sunset").innerText=l,document.getElementById("whatwords").innerText=u}))}},error:function(e,t,n){console.log("Get capital coords isn't working"),console.log(t),console.log(n)}})}function getWebcam(){$.ajax({url:"libs/php/getWebcam.php",type:"GET",dataType:"json",data:{currentCountryCode:currentCountryCode},success:function(e){if("ok"==e.status.name)for(const o of e.data.result.webcams){const e=o.location.latitude,a=o.location.longitude,r=o.title,c=o.player.day.embed,s=o.player.live.embed;function t(){let e=new bootstrap.Modal(document.getElementById("openWebcamToggle"));"available"==o.player.live?document.getElementById("webcamEmbed").src=s:document.getElementById("webcamEmbed").src=c,document.getElementById("webcamName").innerText=r,e.show()}var n=L.ExtraMarkers.icon({icon:"fa-video",markerColor:"#2a9d8f",shape:"square",prefix:"fa",svg:!0});L.marker([e,a],{icon:n}).addTo(webcamMarkers).on("click",t)}}})}function getAirports(){$.ajax({url:"libs/php/getAirports.php",type:"GET",dataType:"json",data:{currentCountryCode:currentCountryCode},success:function(e){if("ok"==e.status.name)for(const n of e.data.response){const e=n.lat,o=n.lng,a=n.name,r=n.icao_code,c=n.iata_code;var t=L.ExtraMarkers.icon({icon:"fa-plane",markerColor:"#e9c46a",shape:"circle",prefix:"fa",svg:!0});null==c?L.marker([e,o],{icon:t}).addTo(airportMarkers).bindPopup(`${a}. <br> ICAO Code: ${r}`):L.marker([e,o],{icon:t}).addTo(airportMarkers).bindPopup(`${c} | ${a}. <br> ICAO Code: ${r}`)}}})}function clearMap(){for(i in airportMarkers.clearLayers(),webcamMarkers.clearLayers(),capitalLayerGroup.clearLayers(),map._layers)if(null!=map._layers[i]._path)try{map.removeLayer(map._layers[i])}catch(e){console.log("problem with "+e+map._layers[i])}}map.on("click",onMapClick),$("#countryOptions").change((function(){currentCountry=document.getElementById("countryOptions").value,getCountryCode()})),$("select").on("click",(function(){$(this).parent(".select-box").toggleClass("open")})),$(document).mouseup((function(e){var t=$(".select-box");0===t.has(e.target).length&&t.removeClass("open")})),$("select").on("change",(function(){var e=$(this).find("option:selected").text(),t=$(this).attr("id");$("[for='"+t+"']").find(".label-desc").html(e)}));