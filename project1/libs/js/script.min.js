var map=L.map("map");function showPosition(e){getPopUp(e.coords.latitude,e.coords.longitude)}navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):document.getElementById("demo").innerText="Geolocation is not supported by this browser.",$(window).on("load",(function(){$("#preloader").length&&$("#preloader").delay(1e3).fadeOut("slow",(function(){$(this).remove()}))}));var Thunderforest_Neighbourhood=L.tileLayer("https://{s}.tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey=e24c409ff68c47bb974a643883a6842b",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:"e24c409ff68c47bb974a643883a6842b",maxZoom:22});L.tileLayer.provider("Thunderforest.Landscape",{apikey:"e24c409ff68c47bb974a643883a6842b"}).addTo(map);const languageNames=new Intl.DisplayNames(["en"],{type:"language"});var currentCountry,currentCountryCode,currentCurrency,currentCapital,lon,lat;function getCountryOptions(){$.ajax({url:"libs/php/getCountrySearchOptions.php",type:"POST",dataType:"json",data:{},success:function(e){const t=e.data,n=document.getElementById("countryOptions");t.sort(),t.forEach((function(e){const t=document.createElement("option");t.value=e,t.innerText=e,n.appendChild(t)}))},error:function(e,t,n){console.log("Get Country Options not working"),console.log(t),console.log(n)}})}function getPopUp(e,t){$.ajax({url:"libs/php/getCountry.php",type:"GET",dataType:"json",data:{lat:e,lng:t},success:function(e){JSON.stringify(e),"ok"==e.status.name&&("countryName"in e.data?(currentCountry=e.data.countryName,currentCountryCode=e.data.countryCode,document.getElementById("countryOptions").value=currentCountry,popUp()):document.getElementById("newPopUp").style.display="none")},error:function(e,t,n){console.log("Find the country isn't working"),console.log(t),console.log(n)}})}$("#searchForm").submit((function(e){e.preventDefault()})),document.getElementById("countryOptions").options,$(document).ready((function(){getCountryOptions()}));var newPopUp=new bootstrap.Modal(document.getElementById("newPopUp"));function popUp(){newPopUp.show(),$("#countryName").html(currentCountry),$("#countryName2").html(currentCountry),$("#countryName3").html(currentCountry),getCountryInfo(),getCountryBorders(),getCurrentNews(),getNeighbours(),getRestInfo(),document.getElementById("countryFlagImg").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("countryFlagImg2").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("countryFlagImg3").src=`https://countryflagsapi.com/svg/${currentCountryCode}`,document.getElementById("wikipediaLink").href=`https://en.wikipedia.org/wiki/${currentCountry}`,document.getElementById("wikipediaLink2").href=`https://en.wikipedia.org/wiki/${currentCountry}`,document.getElementById("wikipediaLink3").href=`https://en.wikipedia.org/wiki/${currentCountry}`}function getCountryInfo(){$.ajax({url:"libs/php/getCountryInfo.php",type:"POST",dataType:"json",data:{country:currentCountryCode},success:function(e){if(JSON.stringify(e),"ok"==e.status.name){currentCapital=e.data.geonames[0].capital;const t=e.data.geonames[0].population,n=e.data.geonames[0].languages,o=e.data.geonames[0].continentName;let a=e.data.geonames[0].areaInSqKm;currentCurrency=e.data.geonames[0].currencyCode;const r=n.split(","),c=[];for(language of r){const e=languageNames.of(language);c.push(e)}getExchangeRate(),getCurrentWeather(),a=parseInt(a).toLocaleString("en-GB"),document.getElementById("capitalCity").innerText=currentCapital,document.getElementById("capitalCity2").innerText=currentCapital,document.getElementById("population").innerText=parseInt(t).toLocaleString("en-GB"),document.getElementById("languagesSpoken").innerText=c.join(", "),document.getElementById("continentName").innerText=o,document.getElementById("countrySurface").innerText=`${a} km²`,document.getElementById("currency").innerText=currentCurrency}},error:function(e,t,n){console.log("Get country info isn't working"),console.log(t),console.log(n)}})}function onMapClick(e){getPopUp(e.latlng.lat,e.latlng.lng)}function getCountryCode(){$.ajax({url:"libs/php/getCountryCode.php",type:"GET",dataType:"json",data:{currentCountry:currentCountry},success:function(e){JSON.stringify(e),"ok"==e.status.name&&(currentCountryCode=e.data,popUp())},error:function(e,t,n){console.log("Get country code isn't working"),console.log(t),console.log(n)}})}function getExchangeRate(){$.ajax({url:"libs/php/getExchangeRate.php",type:"GET",dataType:"json",data:{currentCurrency:currentCurrency},success:function(e){const t=`1 USD equals ${e.data} ${currentCurrency}.`;document.getElementById("exchangeRate").innerText=t},error:function(e,t,n){console.log("Get exchange rate isn't working"),console.log(t),console.log(n)}})}function getCurrentNews(){$.ajax({url:"libs/php/getCurrentNews.php",type:"GET",dataType:"json",data:{country:currentCountryCode},success:function(e){let t="";for(article in e.data.articles){const n=e.data.articles[article].urlToImage,o=e.data.articles[article].title,a=e.data.articles[article].description,r=e.data.articles[article].url;if(null!=n&&null!=o&&null!=a){t+=`\n                    <div>\n                    <section><a class ="text-decoration-none" href="${r}" target="_blank"><img src="${n}" alt=""></a></section>\n                    <section><h3>${o}</h3></section>\n                    <section><p>${a}</p></section>\n                    </div>\n                    `}}document.getElementById("newsArticle").innerHTML=t}})}function getCountryBorders(){$.ajax({url:"libs/php/getCountryBorders.php",type:"GET",dataType:"json",data:{currentCountryCode:currentCountryCode},success:function(e){if(JSON.stringify(e),"ok"==e.status.name){clearMap();const t=e.data,n=L.polygon(t,{color:"pink"}).addTo(map);map.fitBounds(n.getBounds())}},error:function(e,t,n){console.log("Get country borders isn't working"),console.log(t),console.log(n)}})}function getCurrentWeather(){$.ajax({url:"libs/php/getCurrentWeather.php",type:"GET",dataType:"json",data:{capital:currentCapital},success:function(e){if("ok"==e.status.name){let t=e.data.main.temp;lon=e.data.coord.lon,lat=e.data.coord.lat,document.getElementById("currentTemp").innerText=`${Math.round(t)}°C`;let n=e.data.weather[0].icon;document.getElementById("weatherIcon1").src=`http://openweathermap.org/img/wn/${n}@2x.png`,getWeatherForecast()}},error:function(e,t,n){console.log("Get current weather isn't working"),console.log(t),console.log(n)}})}function getWeatherForecast(){$.ajax({url:"libs/php/getWeatherForecast.php",type:"GET",dataType:"json",data:{lat:lat,lon:lon},success:function(e){if("ok"==e.status.name){let t=e.data.list[0].dt,n=e.data.list[0].main.temp,o=`${new Date(1e3*t).getHours()}:00`;document.getElementById("time1").innerText=o,document.getElementById("temp1").innerText=`${Math.round(n)}°C`;let a=e.data.list[1].dt,r=e.data.list[1].main.temp,c=`${new Date(1e3*a).getHours()}:00`;document.getElementById("time2").innerText=c,document.getElementById("temp2").innerText=`${Math.round(r)}°C`;let i=e.data.list[2].dt,u=e.data.list[2].main.temp,l=`${new Date(1e3*i).getHours()}:00`;document.getElementById("time3").innerText=l,document.getElementById("temp3").innerText=`${Math.round(u)}°C`;let s=e.data.list[0].weather[0].icon;document.getElementById("weatherIcon2").src=`http://openweathermap.org/img/wn/${s}@2x.png`;let d=e.data.list[1].weather[0].icon;document.getElementById("weatherIcon3").src=`http://openweathermap.org/img/wn/${d}@2x.png`;let p=e.data.list[2].weather[0].icon;document.getElementById("weatherIcon4").src=`http://openweathermap.org/img/wn/${p}@2x.png`}}})}function getNeighbours(){$.ajax({url:"libs/php/getNeighbours.php",type:"POST",dataType:"json",data:{country:currentCountryCode},success:function(e){if("ok"==e.status.name){let t=[];e.data.forEach((e=>{const n=e.countryName;t.push(n)})),document.getElementById("countryNeighbours").innerText=t.join(", ")}},error:function(e,t,n){console.log("Get neighbours isn't working"),console.log(t),console.log(n)}})}function getRestInfo(){$.ajax({url:"libs/php/getRestInfo.php",type:"POST",dataType:"json",data:{currentCountryCode:currentCountryCode},success:function(e){if("ok"==e.status.name){let t=Object.values(e.data[0].name.nativeName)[0].common,n=Object.values(e.data[0].currencies)[0].symbol,o=e.data[0].car.side;if(e.data[0].postalCode){let t=e.data[0].postalCode.format;document.getElementById("postalCode").innerText=t.split("|").join(", ")}else document.getElementById("postalCode").innerText="Info not available";let a=e.data[0].tld[0];document.getElementById("nativeName").innerText=t,document.getElementById("currencySymbol").innerText=n,document.getElementById("drivingSide").innerText=o,document.getElementById("domainFormat").innerText=a}},error:function(e,t,n){console.log("Get rest info isn't working"),console.log(t),console.log(n)}})}function clearMap(){for(i in map._layers)if(null!=map._layers[i]._path)try{map.removeLayer(map._layers[i])}catch(e){console.log("problem with "+e+map._layers[i])}}map.on("click",onMapClick),$("#countryOptions").change((function(){currentCountry=document.getElementById("countryOptions").value,getCountryCode()})),$("select").on("click",(function(){$(this).parent(".select-box").toggleClass("open")})),$(document).mouseup((function(e){var t=$(".select-box");0===t.has(e.target).length&&t.removeClass("open")})),$("select").on("change",(function(){var e=$(this).find("option:selected").text(),t=$(this).attr("id");$("[for='"+t+"']").find(".label-desc").html(e)}));